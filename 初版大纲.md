### 大纲1.0：“准备 -> 配置 -> 执行 -> 评估”

#### 阶段一：准备阶段 - 信息输入 (Data Input)

此阶段的目标是从用户那里收集所有原始材料，并通过一个**起始 API** 将其安全地发送到后端，后端将利用这些材料“塑造”AI 面试官。

**1.1. 前端 (UI Layer)**

- **组件:** `InterviewSetupForm.jsx`
    
- **功能:** 提供一个表单，包含以下字段：
    
    1. `target_position` (必需)
        
    2. `resume_content` (必需)
        
    3. `job_description` (可选)
        
    4. `company_name` (可选) - **[新功能]**
        
    5. `additional_info` (可选)
        
- **动作:** 用户点击“开始模拟面试”按钮。
    
- **API 调用:**
    
    JavaScript
    
    ```
    // frontend/services/api.js
    async function startInterview(formData) {
      // formData 包含上述所有字段
      return await apiClient.post('/api/v1/interview/start', formData);
    }
    ```
    

**1.2. 后端 (Brain Layer)**

- **API 端点:** `POST /api/v1/interview/start`
    
- **核心动作:**
    
    1. **[新] 公司背景研究 (Company Research):**
        
        - **触发:** 如果 `company_name` 字段**非空**。
            
        - **动作:** 后端服务调用 `Google Search` 工具。
            
        - **Tool Call:** `Google Search(queries=["[Company Name] main business", "[Company Name] industry and products", "关于 [Company Name] 的介绍"])`
            
        - **(!!)[LLM Call #1] 专属提示词: `P-CORP-SUMMARIZE` (公司情境总结)**
            
            > **[System Prompt]:** 你是一个商业分析师。请根据以下关于 “[Company Name]” 的搜索结果，用**一句话**总结这家公司的核心业务领域和主要产品。这个总结将用于设定面试情境。 **[User Prompt]:** 搜索结果：
            > 
            > ```
            > [Search Snippet 1]
            > [Search Snippet 2]
            > ...
            > ```
            > 
            > **[Assistant Output (Example)]:** "美的集团 (Midea) 是一家专注于智能家居、家电、楼宇科技和机器人自动化的全球化科技集团。"
            
    2. **创建会话 (Session):**
        
        - 生成一个唯一的 `session_id`。
            
        - 将所有输入（简历、JD、`company_summary`[来自 LLM #1 的输出]）存储在服务器端的会话存储中（MVP 阶段可以是内存字典，未来是 Redis 或数据库）。
            
    3. **触发阶段二:** 调用内部的“角色理解”逻辑。
        
    4. **返回:** 向前端返回 `session_id` 和阶段二（角色确认）所需的数据。
        

---

#### 阶段二：配置阶段 - 确认与设置 (Configuration)

此阶段的目标是确保 AI 面试官的“人设”准确无误，并让用户完成最终设置。

**2.1. 角色理解与确认 (LLM Verification)**

- **后端 (Brain Layer) - 内部触发:**
    
    - **触发:** 在 `POST /api/v1/interview/start` 逻辑的末尾，如果**未提供** `job_description` (JD)。
        
    - **(!!)[LLM Call #2] 专属提示词: `P-ROLE-VERIFY` (AI 角色确认)**
        
        > **[System Prompt]:** 你是一位资深的 HR 专家和技术面试官。你的任务是根据候选人的目标岗位、简历和目标公司，来确认你即将扮演的“面试官”角色。 **[User Prompt]:** 请基于以下信息，生成一段 2-3 句话的“角色确认”描述，并以“这是您期望的面试角色吗？”结尾：
        
        > - **目标岗位:** "[target_position]"
        >     
        > - **目标公司:** "[company_summary]" (如果存在)
        
        > **[Assistant Output (Example)]:** "根据您的简历和[target_position]的岗位，我理解您申请的是 [美的集团] 这样的科技企业。这个角色似乎不仅需要精通 React，还需要对 IoT 或智能家居的联动有一定了解。这是您期望的面试角色吗？"
        
- **前端 (UI Layer):**
    
    - **组件:** `RoleVerificationModal.jsx`
        
    - **功能:**
        
        - 显示从后端收到的“角色确认”文本 (来自 LLM #2)。
            
        - 提供按钮：“[确认，开始面试]” 或 “[修正]”（并附带一个输入框）。
            
    - **API 调用 (如果修正):**
        
        JavaScript
        
        ```
        // frontend/services/api.js
        async function correctRole(sessionId, correctionText) {
          return await apiClient.post('/api/v1/interview/configure', {
            session_id: sessionId,
            role_correction: correctionText
          });
        }
        ```
        

**2.2. 面试参数设置 (Settings)**

- **前端 (UI Layer):**
    
    - **组件:** `SettingsForm.jsx`
        
    - **功能:** 允许用户选择“面试模式”（A/B）、“问题数量”、“难度等级”。
        
    - **API 调用 (最终确认):**
        
        JavaScript
        
        ```
        // frontend/services/api.js
        async function confirmSettings(sessionId, settings) {
          // settings: { mode: 'A', count: 10, difficulty: 'Senior' }
          return await apiClient.post('/api/v1/interview/start_session', settings);
        }
        ```
        
- **后端 (Brain Layer):**
    
    - **API 端点:** `POST /api/v1/interview/start_session`
        
    - **核心动作:**
        
        1. 将会话状态标记为“进行中”。
            
        2. 保存 `settings` 到会话。
            
        3. **触发“阶段三”：** 调用内部逻辑，生成**第一个**面试问题。
            

---

#### 阶段三：执行阶段 - 模拟面试 (Simulation)

这是核心的问答循环，完全由后端 API 驱动。

- **后端 (Brain Layer) - 内部触发:**
    
    - **(!!)[LLM Call #3] 专属提示词: `P-QUESTION-GENERATE` (动态问题生成)**
        
        > **[System Prompt]:** 你是 [Difficulty] 级别的面试官，正在 [Company Summary] (如果存在) 进行一场 [Target Position] 的面试。你的提问必须严格、专业、富有洞察力，并能进行追问。 **[User Prompt]:**
        
        > - **面试情境:** 这是 [Total Questions] 个问题中的第 [Current N] 个。
        >     
        > - **候选人资料:**
        >     
        >     - 简历: [resume_content]
        >         
        >     - JD: [job_description]
        >         
        >     - 角色修正(如果存在): [role_correction]
        >         
        > - **面试历史 (用于追问):** [Chat History... (Q1, A1, Q2, A2...)]
        >     
        
        > **你的任务:**
        
        > 1. **分析** 上下文。
        >     
        > 2. **决定** 下一个问题的主题（例如：简历深挖、行为面试、技术考核、情景问题）。
        >     
        > 3. **生成** 下一个面试问题。
        >     
        
        > **规则:**
        
        > - **不要** 说任何寒暄语 (例如 "很好", "谢谢你的回答")。
        >     
        > - **只输出** 问题本身。
        >     
        
        > **[Assistant Output (Example)]:** "我注意到你在简历中提到了一个智能家居的项目。你当时是如何处理设备间（如 App 与空调）的实时通信和状态同步的？"
        
- **前端 (UI Layer):**
    
    - **组件:** `ChatInterface.jsx`
        
    - **功能:**
        
        - 在聊天气泡中显示 AI 的问题 (来自 LLM #3)。
            
        - 提供一个输入框让用户输入答案。
            
        - 点击“提交回答”按钮。
            
    - **API 调用:**
        
        JavaScript
        
        ```
        // frontend/services/api.js
        async function submitAnswer(sessionId, answerText) {
          // 在发送时，前端应显示“AI 思考中...”的加载状态
          return await apiClient.post('/api/v1/interview/submit_answer', {
            session_id: sessionId,
            answer: answerText
          });
        }
        ```
        
- **后端 (Brain Layer):**
    
    - **API 端点:** `POST /api/v1/interview/submit_answer`
        
    - **核心动作:**
        
        1. 接收并保存用户的 `answer` 到会话历史。
            
        2. 检查是否达到 `Total Questions` 限制。
            
        3. **如果未结束:**
            
            - 再次调用 **[LLM Call #3: `P-QUESTION-GENERATE`]** 来获取_下一个_问题（LLM 会看到包含最新答案的“面试历史”，从而实现“追问”）。
                
            - 将新问题返回给前端。
                
        4. **如果已结束:**
            
            - 触发“阶段四”：调用内部的“评估逻辑”。
                
            - 向前端返回一个“评估中”的状态。
                

_(注：对于“模式 B: 全自动演示”，后端在收到 `submit_answer` 请求时，会先调用一个 [LLM Call #3.5: `P-DEMO-ANSWER`] 来生成“示例回答”，然后再调用 LLM #3 生成下一个问题。)_

---

#### 阶段四：评估阶段 - 反馈与总结 (Feedback)

这是“大脑”进行最终复盘的阶段。

- **后端 (Brain Layer) - 内部触发:**
    
    - **触发:** 当最后一个问题回答完毕时。
        
    - **核心动作:** 从会话中提取所有数据（简历、JD、公司情境、完整的 Q&A 历史）。
        
    - **(!!)[LLM Call #4] 专属提示词: `P-FINAL-REPORT` (综合评估报告)**
        
        > **[System Prompt]:** 你是一位顶级的职业规划导师和面试专家。你将对一场刚刚结束的模拟面试进行全面、深入、且富有建设性的评估。 **[User Prompt]:** **面试档案:**
        
        > - 岗位: [Target Position]
        >     
        > - 公司情境: [Company Summary]
        >     
        > - 难度: [Difficulty]
        >     
        > - 简历: [resume_content]
        >     
        
        > **面试完整记录 (Q&A):**
        
        > ```
        > Q1: [Question 1]
        > A1: [Answer 1]
        > ```
        
        > Q2: [Question 2] A2: [Answer 2] ...
        
        > **你的任务:** 请严格按照以下 JSON 格式，生成一份详细的面试反馈报告：
        
        > JSON
        > 
        > ```
        > {
        >   "overall_score": <一个 0-100 的总分>,
        >   "overall_summary": "<一段 2-3 句话的总体评价>",
        >   "scoring_matrix": {
        >     "skill_match": <0-10 分，评估技术与岗位的匹配度>,
        >     "company_fit": <0-10 分，评估对公司情境(如美的/字节)的理解>,
        >     "communication_clarity": <0-10 分，评估沟通表达能力>,
        >     "star_method_application": <0-10 分，评估行为问题回答的结构性>
        >   },
        >   "per_question_analysis": [
        >     {
        >       "question": "[Question 1]",
        >       "answer": "[Answer 1]",
        >       "feedback_strengths": "<关于这个回答的优点>",
        >       "feedback_improvements": "<关于这个回答的具体改进建议>",
        > ```
        
        - "suggested_answer": "<一个针对此问题的更优回答示例>"
            
        
        > ```
        > }
        > // ... 为每一个 Q&A 对重复此结构 ...
        > ```
        
        > ], "final_recommendations": [ "<最关键的改进建议 1>", "<最关键的改进建议 2>" ] }
        
- **后端 (Brain Layer):**
    
    - **API 端点:** `GET /api/v1/interview/report?session_id=...` (前端在收到“评估中”状态后轮询或用 WebSocket 接收此报告)。
        
    - **核心动作:** 返回 [LLM Call #4] 生成的 JSON 报告。
        
- **前端 (UI Layer):**
    
    - **组件:** `FinalReport.jsx`
        
    - **功能:**
        
        - 获取并解析报告 JSON。
            
        - 以信息图表（用于 `scoring_matrix`）、手风琴折叠（用于 `per_question_analysis`）等富 UI 形式，优雅地展示这份完整的评估报告。